@page "/"
@using NewsAggregatorWebWASMUI.Models
@inject HttpClient _httpClient

<PageTitle>Новости</PageTitle>

<h3>Новости</h3>
<div style="margin-bottom: 25px; margin-top: 25px">
    <div class="input-group mb-3">
        <label class="input-group-text" for="category">Категория:</label>
        <select class="form-select" id="category" @bind="_category" @bind:event="onchange">
            <option value="news" selected>Новости</option>
            <option value="articles">Истории</option>
            <option value="shapito">Шапито</option>
        </select>
        <button class="btn btn-primary" type="button" @onclick="ShowHeadings">Показать</button>
    </div>
</div>

@if (ShowSpinner)
{
    <Spinner/>
}

@if (_showHeadingsList)
{
    <HeadingsListComponent Headings="_headings"/>
}

@code {
    private bool _showHeadingsList;
    private List<Heading>? _headings = new();
    private string? _category = "news";

    private bool ShowSpinner { get; set; }

    private async Task ShowHeadings()
    {
        _showHeadingsList = false;
        ShowSpinner = true;
        var headings = await _httpClient
            .GetFromJsonAsync<IEnumerable<Heading>>($"https://headings-river.herokuapp.com/Headings/{_category}") ?? Array.Empty<Heading>();
        _headings = headings.ToList();

        if (_headings.Count > 0)
        {
            _showHeadingsList = true;
        }
        ShowSpinner = false;
    }

}